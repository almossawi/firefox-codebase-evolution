
<!DOCTYPE html>
<html>
  <head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<title>The evolution of the Firefox codebase</title>
	<link rel="stylesheet" href="css/styles.css" type="text/css" charset="utf-8" />
	
	<link href='https://fonts.googleapis.com/css?family=Cardo' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Signika:400,300' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600" rel="stylesheet" type="text/css" />
	<link href='https://fonts.googleapis.com/css?family=Old+Standard+TT:400,400italic,700' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.4/jquery-ui.min.js" type="text/javascript"></script>
		
	<script src="http://d3js.org/d3.v3.min.js"></script>
   	<script type="text/javascript" src="js/global.js"></script>
   	<script type="text/javascript" src="js/jquery.uniform.min.js" charset="utf-8"></script>
  </head>
  <body>
  	<div id="main_options">
			<a href="#"><div style="border-right:1px solid #3b3b3b">
				MATRIX
			</div></a>
			<a href="#"><div style="border-right:1px solid #3b3b3b">
				<span class="selected">CHART</span>
				<div class="selected_view"></div>
			</div></a>
			<a href="#"><div>
				NETWORK
			</div></a>
	</div>
		
	<div id="page">		
		<!--<h1>Firefox module breakdown</h1>
		<p>Here, we look at the modules of the two selected versions of Firefox for Desktop and analyze a set of metrics for each module that are indicative of quality.  Only modules that have a reasonable level of complexity are analyzed.  We define that using several criteria, one of which is that a module must have at least 400 source-code files; the rest are a bit more nuanced.</p>-->
		<div id="version_select">
			<a href="#"><img src="images/lhs_left.png" id="lhs_left" class="version_arrow" /></a>
			<a href="#"><img src="images/lhs_right.png" id="lhs_right" class="version_arrow" /></a>
			<img src="images/firefox_tiny.png" style="padding-left:10px;padding-right:10px" />
			<a href="#"><img src="images/rhs_left.png" id="rhs_left" class="version_arrow" /></a>
			<a href="#"><img src="images/rhs_right.png" id="rhs_right" class="version_arrow" /></a>
		</div>
		<div id="metric">
			<div id="loc_code" class="topmetric"></div>
			<div id="mccabe_per_kloc_code" class="topmetric"></div>
			<div id="prop_cost" class="topmetric"></div>
			<div id="percent_in_core" class="topmetric"></div>
			<div id="sum_fanin" class="topmetric"></div>
			<div id="sum_vfanin" class="topmetric"></div>
		</div>
		
		<div style="clear:both"></div>
		
		<div id="container">
			<div style="margin-top:40px;text-align:left">
				<p>This work presents a set of metrics for all releases of Firefox for Desktop that are indicative of quality.  By looking at changes in these metrics, one can see the evolution of the Firefox codebase over time.  They can also be useful as a retrospective tool to help infer when, say, architectural issues may be the cause for unfavorable user sentiment following a release.</p>
				<p>Metrics such as lines-of-code (LOC) and cyclomatic complexity are widely used in industry, whereas other metrics like propagation cost are based on some of the more recent research to come out of academia.  For the module breakdown view, <i>Chart</i>, only modules that have a reasonable level of complexity are shown, i.e. several hundred files.  Select an option from the top to change the view.  Descriptions of what each metric captures and how it is calculated are shown below, as are some additional measures of quality, such as speed and resident memory usage, both of which have improved in Firefox.</p>
				<br />
			</div>
		
			<div style="clear:both"></div>
		
			<div id="chart_container_container">
				<div class="chart_description">
					<h1>Defect density</h1>
					<p>Defect density measures the number of confirmed bugs per release divided by the number of thousands of lines of code (not counting blanks and comments). The bug data is from Bugzilla.  A set of http queries are run against Mozilla's bug tracking system, Bugzilla, to get the counts per release. Since the version field in Bugzilla is optional, the defect counts currently don't include confirmed bugs that have not been assigned to particular releases. We have a relatively robust method for including unassigned defects that we may end up using in the future.  We start from version 5.0 since that is when the rapid release cycle began.</p>
				</div>
				<div class="chart_container" id="allversions_defects_per_kloc">
					<span class="container_title">Defect density</span>
					<div></div>
				</div>
				<div style="clear:both"></div>
						
				<div class="chart_description">
					<h1>LOC</h1>
					<p>LOC measures the number executable lines of code in each release, and so it ignores comments and blank lines.  Studies have shown that the measure tends to have an inverse relationship with defect density, that is to say, a larger system size has a smaller defect density, though other studies show it to be curvilinear relationship: defect density decreases linearly as system size increases only to then curve up at the tail<sup>1</sup>.</p>
					<p style='font-size:80%'><sup>1</sup> Kahn, S., Metrics and Models in Software Quality (2002).</p>
				</div>
				<div class="chart_container" id="allversions_loc_code">
					<span class="container_title">LOC</span>
					<div></div>
				</div>
				
				<div class="chart_description">
					<h1>Cyclomatic complexity</h1>
					<p>Cyclomatic complexity, developed by Thomas McCabe in 1976, measures the number of linearly independent paths within a software system and can be applied either to the entire system or to a particular class or function. By viewing a block of code as a control graph, the nodes constitute indivisible lines of code that execute in sequence and the directed edges connect two nodes if one can occur after the other. So, for example, branching constructs like if-else statements would result in a node being connected to two output nodes, one for each branch.</p>
					<p>The formula for the measure is defined as <i>v(G) = e – n + 2p</i> where v(G) is the cyclomatic number of a graph G, e is the number of edges, n is the number of nodes and p is the number of connected components, or exit nodes, in the graph. A block of code with a single if-else statement would have be calculated as follows: e = 6, n = 6 and p = 1, therefore, v(G) = 6 – 6 + 2 * 1 = 2. The additive nature of the metric means that the complexity of several graphs is equal to the sum of each graph.  In our measure of cyclomatic complexity, we control for size.</p>
				</div>
				<div class="chart_container" id="allversions_mccabe_per_kloc">
					<span class="container_title">Cyclomatic complexity</span>
					<div></div>
				</div>
				<div style="clear:both"></div>
				
				<div class="chart_description">
					<h1>Propagation cost</h1>
					<p>Propagation cost measures direct as well as indirect dependencies between the files in a code-base, which is a more vivid view of a system's interdependencies. A number of studies have shown that propagation cost is a significant positive predictor of software quality.  Propagation cost is defined as <i>propagation cost = (&Sigma;rows)/m<sup>2</sup></i>, where m is the matrix width/height.</p>
					<p>The process of transforming a first-order dependency matrix that captures only direct dependencies between files to a visibility matrix that captures indirect dependencies as well can be achieved through matrix multiplication. To obtain a visibility matrix, a matrix is raised to successive powers of n, where n represents path lengths. Put differently, that means that if the matrix is raised to the power of two, it would then show the indirect dependencies between elements that have a path length of two, i.e. calls from A to C, if A calls B and B calls C. Thereafter, by summing these matrices together one gets the visibility matrix, V. For this ripple effect to be useful for analysis, it is captured within a metric called propagation cost<sup>2</sup>.</p>
					<p style='font-size:80%'><sup>2</sup> MacCormack, A. et al, <i>Exploring the Structure of Complex Software Designs: An Empirical Study of Open Source and Proprietary Code</i> (2006).</p>
				</div>
				<div class="chart_container" id="allversions_prop_cost">
					<span class="container_title">Propagation cost</span>
					<div></div>
				</div>
				
				<div class="chart_description">
					<h1>Core size</h1>
					<p>Core files are files that depend on a lot of files and have a lot of files depend on them, i.e. they have high fan-in and high fan-out. It is one of four types of files that one sees when plotting them along the axes of fan-in and fan-out, the intuition being that different directions and magnitudes of dependencies have varying impacts on software quality. A smaller core has been shown to result in fewer defects.</p>
					<ul>
					    <li>Peripheral files don’t depend on a lot of files and don't have a lot of files depend on them (low fan-in, low fan-out).</li>
					    <li>Shared files don’t depend on a lot of files, but have a lot of files depend on them (high fan-in, low fan-out).</li>
					    <li>Control files depend on a lot of files, but don’t have a lot of files depend on them (low fan-in, high fan-out).</li>
    				</ul>
					<p>The percentage of files that have a fan-in above the fan-in median and a fan-out above the fan-out median are divided by the total number files minus singletons, i.e. files that don't make any call-outs or call-ins gives us the core size.</p>
				</div>
				<div class="chart_container" id="allversions_percent_in_core">
					<span class="container_title">Core size</span>
					<div></div>
				</div>
				<div style="clear:both"></div>

				<div class="chart_description">
					<h1>Resident memory</h1>
					<p>The resident memory usage of Firefox for Desktop after the TP5 test is left running for 30 seconds. Resident memory is the physical amount of memory used by the Firefox process. The TP5 test, run five times in sequence, loads a set of 100 popular webpages into the browser, with a ten-second delay between each page load.</p>
					<p>We run our memory usage tests on builds from mozilla-central. The result for each release is based on the latest test that was done on the code in mozilla-central before it was branched off to its release-specific branch. There is a gap of a number of weeks between that codebase and the codebase of the final release, hence it is important to keep this caveat in mind when interpreting the data.</p>
					<p>The data is provided by our colleagues at areweslimyet.com. See their <a href="https://areweslimyet.com/faq.htm">FAQ</a> for more info.</p>
				</div>
				<div class="chart_container" id="allversions_mem">
					<span class="container_title">Resident memory</span>
					<div></div>
				</div>
				
				<div class="chart_description">
					<h1>Speed</h1>
					<p>The V8 score of each release.  We run our speed tests on builds from mozilla-central. The score for each release is based on the latest test that was done on the code in mozilla-central before it was branched off to its release-specific branch. There is a gap of a number of weeks between that codebase and the codebase of the final release, hence it is important to keep this caveat in mind when interpreting the data.</p>
					<p>The data is provided by our colleagues at arewefastyet.com.</p>
				</div>
				<div class="chart_container" id="allversions_speed">
					<span class="container_title">Speed</span>
					<div></div>
				</div>
			</div><!-- end #container -->
			
			<div style="clear:both"></div>
			
			<div id="wide_pane">		
			<div id="logo_container">	
				<div id="twitter_block">
<a href="https://twitter.com/share" data-size="large" class="twitter-share-button">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
				</div>
				
				<div id="fb_block" class="fb-like" data-href="http://almossawi.com/firefox" data-send="false" data-layout="box_count" data-width="150" data-show-faces="false" data-font="arial"></div>
				
				<div id="credits_block">
					<a href="http://almossawi.com">ALI ALMOSSAWI</a> &middot; almossawi@mozilla.com &middot; <a href="https://twitter.com/alialmossawi">Follow me on Twitter</a> &middot; April 2013<br />
					Background image courtesy of <a href="https://twitter.com/tyronflanagan">Ty Flanagan</a>.  This work is being released under a Creative Commons Attribution-NonCommercial license (<a href="http://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC</a>).
				</div>
			</div>
			</div>
		</div>
	</div>
	
	<script>
		var images = [
			'images/lhs_left.png',
			'images/lhs_right.png',
			'images/rhs_left.png',
			'images/rhs_right.png',
		];

		$(images).each(function() {
			var image = $('<img />').attr('src', this);
		});
		</script>
  </body>
</html>
